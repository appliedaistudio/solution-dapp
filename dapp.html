<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="./manifest.json">
    <title>Hello World App</title>
    <link rel="stylesheet" href="./lib/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="./lib/fontawesome/css/all.min.css">
    
    <!-- Other Custom Styles -->
    <link rel="stylesheet" href="./css/base/variables.css">
    <link rel="stylesheet" href="./css/base/base.css">
    <link rel="stylesheet" href="./css/layout/layout.css">
    <link rel="stylesheet" href="./css/components/buttons.css">
    <link rel="stylesheet" href="./css/components/menu.css">
    <link rel="stylesheet" href="./css/components/controls.css">
    <link rel="stylesheet" href="./css/components/ai-chat-button.css">
    <link rel="stylesheet" href="./css/components/ai-chat.css">
    <link rel="stylesheet" href="./css/utils/responsive.css">

    <!-- Used to encrypt user passwords-->
    <script src="./lib/bcrypt/js/bcrypt.min.js"></script>
</head>
<body class="text-center">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js').then(function(registration) {
                console.log('Service Worker registration successful with scope:', registration.scope);
            }).catch(function(error) {
                console.log('Service Worker registration failed:', error);
            });
        }
    </script>
    
    <div id="app-container" class="d-flex flex-column align-items-center justify-content-center vh-100">
        <div id="app-content" class="bg-dark text-white p-4 rounded-lg">
            <div id="menu-container" class="mb-3 mb-md-4 mb-lg-5"></div>
            <h1 id="app-title">Hello World</h1>
            <div id="main-content">
                <p>Here's a short message in the main content area.</p>
                <button class="ai-chat-button" data-bs-toggle="modal" data-bs-target="#chatModal"></button>
            </div>
            <div id="main-content-controls"></div>
        </div>
    </div>
    
    <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="chatModalLabel">AI Chat</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 chat-conversations-list" style="border-right: 1px solid #ddd;">
                            <button class="chat-conversation-btn w-100 my-1" onclick="switchConversation(1)">Conversation 1</button>
                            <button class="chat-conversation-btn w-100 my-1" onclick="switchConversation(2)">Conversation 2</button>
                        </div>
                        <div class="col-md-8">
                            <div class="card chat-window" id="chat-window">
                                <div class="card-header chat-header d-flex justify-content-between align-items-center p-3">
                                    <p class="mb-0 fw-bold">Selected Conversation</p>
                                </div>
                                <div class="card-body chat-body"></div>
                                <div class="input-group chat-input-group mb-3">
                                    <button class="chat-voice-btn" onclick="startVoiceToText()">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <input type="text" class="chat-message-input" placeholder="Type your message here...">
                                    <button class="chat-send-btn" onclick="sendMessage()">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                                <div class="chat-suggested-messages">
                                    <button class="btn btn-outline-secondary btn-sm m-1" onclick="sendMessage('Hello!')">Hello!</button>
                                    <button class="btn btn-outline-secondary btn-sm m-1" onclick="sendMessage('Can you help me?')">Can you help me?</button>
                                    <button class="btn btn-outline-secondary btn-sm m-1" onclick="sendMessage('Thank you!')">Thank you!</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- External libraries and scripts -->
    <script src="./lib/pouchdb/pouchdb.min.js"></script>
    <script src="./lib/vibrant/vibrant.min.js"></script>
    <script src="./lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { updateThemeColorsBasedOnImage } from './js/ui/ui-color-extractor.js';
        import config from './js/dapp-config.js';
        document.addEventListener('DOMContentLoaded', () => {
            updateThemeColorsBasedOnImage(config.backgroundImage);
        });
    </script>
    <script type="module" src="./js/ui/ui-auth.js"></script>
    <script type="module" src="./js/dapp.js"></script>

    <script>
        function sendMessage(messageText = null) {
            const messageInput = document.getElementById('messageInput');
            const message = messageText || messageInput.value;
            console.log("Message sent:", message);
            messageInput.value = '';
        }

        function startVoiceToText() {
            console.log("Voice-to-text entry started");
        }

        function switchConversation(conversationId) {
            document.querySelectorAll('.chat-conversation-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`.chat-conversation-btn:nth-child(${conversationId * 2 - 1})`);
            if (activeBtn) activeBtn.classList.add('active');
            const chatWindowHeader = document.querySelector('.chat-window .card-header p');
            chatWindowHeader.innerText = `Selected Conversation: ${conversationId}`;
            const chatBody = document.querySelector('.chat-window .card-body');
            chatBody.innerHTML = `<p>Loading conversation ${conversationId}â€¦</p>`;
        }
    </script>
</body>
</html>